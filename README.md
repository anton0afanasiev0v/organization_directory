# organization_directory

**Тестовое задание "Создание REST API приложения"**

**Описание.**

Необходимо реализовать **REST API** приложения для справочника *Организаций*, *Зданий*, *Деятельности*.

## Сущности

### 1. Организация
Представляет собой карточку организации в справочнике и должна содержать в себе следующую информацию:

- **Название**: Например ООО "Рога и Копыта"
- **Номер телефона**: организация может иметь несколько номеров телефонов (2-222-222, 3-333-333, 8-923-666-13-13)
- **Здание**: Организация должна находится в одном конкретном здании (Например, Блюхера, 32/1)
- **Деятельность**: Организация может заниматься несколькими видами деятельностей (Например, "Молочная продукция", "Мясная продукция")

### 2. Здание
Содержит в себе как минимум информацию о конкретном здании, а именно:

- **Адрес**: Например - г. Москва, ул. Ленина 1, офис 3
- **Географические координаты**: Местоположение здания должно быть в виде широты и долготы.

### 3. Деятельность
Позволяет классифицировать род деятельности организаций в каталоге. Имеет название и может в древовидном виде вкладываться друг в друга. Пример возможного дерева деятельности:

- Еда
    - Мясная продукция
    - Молочная продукция
- Автомобили
    - Грузовые
    - Легковые
        - Запчасти
        - Аксессуары

## Технологический стек

- **Backend**: FastAPI + Pydantic + SQLAlchemy + Alembic
- **База данных**: PostgreSQL
- **Контейнеризация**: Docker + Docker Compose
- **Документация**: Swagger UI

## API Эндпоинты

### Организации
- `GET /organizations/` - Получить список всех организаций
- `GET /organizations/{organization_id}` - Получить информацию об организации по ID
- `POST /organizations/` - Создать новую организацию
- `GET /organizations/search/name?name={name}` - Поиск организаций по названию
- `GET /organizations/building/{building_id}` - Получить организации в конкретном здании
- `GET /organizations/activity/{activity_id}` - Получить организации по виду деятельности (с учетом иерархии)
- `POST /organizations/search/range` - Поиск организаций в прямоугольной области
- `POST /organizations/search/radius` - Поиск организаций в радиусе от точки

### Здания
- `GET /buildings/` - Получить список всех зданий
- `GET /buildings/{building_id}` - Получить информацию о здании по ID
- `POST /buildings/search/range` - Поиск зданий в прямоугольной области
- `POST /buildings/search/radius` - Поиск зданий в радиусе от точки

### Деятельности
- `GET /activities/` - Получить список всех деятельностей
- `GET /activities/{activity_id}` - Получить информацию о деятельности по ID
- `GET /activities/tree` - Получить дерево деятельностей

## Функциональные требования

✅ **Реализованные методы:**

- Список всех организаций находящихся в конкретном здании
- Список всех организаций, которые относятся к указанному виду деятельности
- Список организаций, которые находятся в заданном радиусе/прямоугольной области относительно указанной точки на карте
- Вывод информации об организации по её идентификатору
- Поиск организаций по виду деятельности с учетом иерархии (например, по "Еда" находятся все организации с "Мясная продукция", "Молочная продукция")
- Поиск организации по названию
- Ограничение уровня вложенности деятельностей 3 уровнями

## Развертывание

### Быстрый старт с Docker

1. **Клонируйте репозиторий:**
   ```bash
   git clone <repository-url>
   cd organization_directory
   ```

2. **Запустите приложение:**
   ```bash
   docker-compose up --build
   ```

3. **Проверьте работу приложения:**
   - API: http://localhost
   - Swagger документация: http://localhost/docs
   - Health check: http://localhost/health

Подробная инструкция по развертыванию доступна в файле [DOCKER_DEPLOYMENT.md](DOCKER_DEPLOYMENT.md)

### Локальная разработка

1. **Установите зависимости:**
   ```bash
   pip install -e .
   ```

2. **Настройте переменные окружения:**
   ```bash
   export DATABASE_URL="postgresql://user:password@localhost:5432/organization_db"
   ```

3. **Запустите приложение:**
   ```bash
   uvicorn src.main:app --reload
   ```

## Документация API

После запуска приложения доступна интерактивная документация:

- **Swagger UI**: http://localhost/docs
- **ReDoc**: http://localhost/redoc

## Аутентификация

Все эндпоинты требуют статический API ключ в заголовке:
```
X-API-Key: your-api-key-here
```

## База данных

- **Тип**: PostgreSQL
- **Миграции**: Alembic
- **ORM**: SQLAlchemy

## Структура проекта

```
src/
├── api/v1/          # API роутеры
├── dto/             # Pydantic модели
├── model/           # SQLAlchemy модели
├── repository/      # Репозитории (слой доступа к данным)
├── service/         # Сервисы (бизнес-логика)
├── database.py      # Настройки базы данных
├── main.py          # Точка входа
└── security.py      # Безопасность
```

## Тестовые данные

Для создания тестовых данных используйте эндпоинт:
```bash
curl -X POST "http://localhost/organizations/fixtures/create" \
  -H "X-API-Key: your-api-key"
```

Проверка статуса тестовых данных:
```bash
curl -X GET "http://localhost/organizations/fixtures/status" \
  -H "X-API-Key: your-api-key"
```